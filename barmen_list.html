<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Бармен</title>
<style>
body{background:#000;color:#fff;font-family:Arial;padding:20px}
.card{border:1px solid #333;padding:15px;margin-bottom:10px;border-radius:12px}
input{width:60px}
</style>
</head>
<body>

<h1>Панель бармена</h1>
<div>Сумма: <span id="sum">0</span> ₽</div>
<div id="list"></div>

<script>

const SHEET_ID="1CceZ3cIic_k9Z9GnXg_wOzoUGdYonzVkfypmSzf_ln8";
const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=БАР_КУХНЯ`;

let cocktails=[];
let total=0;

fetch(url)
.then(r=>r.text())
.then(txt=>{

    const json=JSON.parse(txt.substr(47).slice(0,-2));
    const rows=json.table.rows;

    let current=null;

    rows.forEach(r=>{

        const c=r.c;

        const id = c[0]?.v;
        const name = c[1]?.v;
        const cost = c[3]?.v;
        const ing = c[5]?.v;
        const qty = c[6]?.v;
        const unit = c[7]?.v;
        const recipe = c[10]?.v;

        if(id){
            current={
                name:name,
                cost:parseFloat(cost)||0,
                recipe:recipe||"",
                ings:[]
            };
            cocktails.push(current);
        }

        if(ing){
            current?.ings.push(`${ing} ${qty} ${unit}`);
        }
    });

    render();
});

function render(){
    const list=document.getElementById("list");
    list.innerHTML="";

    cocktails.forEach((c,i)=>{

        list.innerHTML+=`
        <div class="card">
            <b>${c.name}</b><br>
            ${c.ings.join("<br>")}
            <br><br>
            Сделано:
            <input type="number" value="0" min="0" onchange="calc()">
        </div>`;
    });
}

function calc(){
    total=0;
    document.querySelectorAll("input").forEach((inp,i)=>{
        total += (parseInt(inp.value)||0)*cocktails[i].cost;
    });
    document.getElementById("sum").innerText=total;
}

</script>
</body>
</html>
