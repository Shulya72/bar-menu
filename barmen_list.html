<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Бармен</title>
<style>
body{
    background:#000;
    color:#fff;
    font-family:Arial;
    text-align:center;
}
.card{
    border:1px solid #333;
    border-radius:14px;
    margin:30px auto;
    padding:20px;
    width:420px;
}
img{
    width:260px;
    border-radius:12px;
}
.price{
    color:#7CFC00;
}
.total{
    color:#7CFC00;
    font-weight:bold;
    margin-top:10px;
}
</style>
</head>
<body>

<h1>Панель бармена</h1>
<h2 id="sum">Сумма: 0 ₽</h2>

<div id="app"></div>

<script>

const SHEET="1CceZ3cIic_k9Z9GnXg_wOzoUGdYonzVkfypmSzf_ln8";

const techURL="https://opensheet.elk.sh/"+SHEET+"/БАР_КУХНЯ";
const menuURL="https://opensheet.elk.sh/"+SHEET+"/MENU";

let tech=[];
let menu=[];

Promise.all([
fetch(techURL).then(r=>r.json()),
fetch(menuURL).then(r=>r.json())
]).then(([t,m])=>{
    tech=t;
    menu=m;
    build();
});

function getPrice(name){
    let row=tech.find(r=>r["Магазин"]==name || r["Ингредиент"]==name);
    if(!row) return 0;

    let price=row["Цена за ед."] || row["undefined"] || 0;

    price=String(price).replace("₽","").replace(",",".");
    return parseFloat(price)||0;
}

function build(){

    const app=document.getElementById("app");

    menu.forEach(c=>{

        if(!c.Коктейль) return;

        let block=document.createElement("div");
        block.className="card";

        let html=`<h2>${c.Коктейль}</h2>`;

        if(c.Фото){
            html+=`<img src="${c.Фото}">`;
        }

        let cost=0;

        tech.forEach(r=>{

            if(r["Технологические карты"]!=c["№"]) return;
            if(!r["Ингредиент"]) return;

            let name=r["Ингредиент"];
            let qty=parseFloat(r["Кол-во"])||0;

            let p=getPrice(name);
            let sum=p*qty;

            cost+=sum;

            html+=`
            <div>
            ${name} ${qty} — 
            <span class="price">${sum.toFixed(2)} ₽</span>
            </div>`;
        });

        html+=`<div class="total">Стоимость коктейля: ${cost.toFixed(2)} ₽</div>`;

        html+=`
        <div style="margin-top:10px">
        Сделано: <input type="number" value="0" style="width:60px">
        </div>`;

        block.innerHTML=html;
        app.appendChild(block);

    });

}

</script>
</body>
</html>
