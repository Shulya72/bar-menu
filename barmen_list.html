<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Бармен</title>

<style>
body{
    background:#000;
    color:#fff;
    font-family:Arial;
    padding:20px;
}

.card{
    border:1px solid #333;
    padding:18px;
    margin-bottom:18px;
    border-radius:16px;
}

img{
    width:100%;
    max-width:320px;
    border-radius:12px;
    margin-bottom:10px;
}

.tools{color:#7CFC00;margin-top:8px}
.recipe{color:#aaa;margin-top:10px}
</style>
</head>

<body>

<h1>Панель бармена</h1>
<div>Себестоимость вечера: <span id="sum">0</span> ₽</div>
<br>
<div id="list"></div>

<script>

const SHEET_ID="1CceZ3cIic_k9Z9GnXg_wOzoUGdYonzVkfypmSzf_ln8";

const techURL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=БАР_КУХНЯ`;
const menuURL=`https://opensheet.elk.sh/${SHEET_ID}/MENU`;

let cocktails=[];
let photos={};
let total=0;

Promise.all([
    fetch(techURL).then(r=>r.text()),
    fetch(menuURL).then(r=>r.json())
])
.then(([techTxt,menuData])=>{

    // фото
    menuData.forEach(r=>{
        photos[r.Коктейль]=r.Фото;
    });

    // техкарта
    const json=JSON.parse(techTxt.substr(47).slice(0,-2));
    const rows=json.table.rows;

    let current=null;

    rows.forEach(r=>{
        const c=r.c;

        const id = c[0]?.v;
        const name = c[1]?.v;
        const cost = c[3]?.v;
        const ing = c[5]?.v;
        const qty = c[6]?.v;
        const unit = c[7]?.v;
        const tool = c[9]?.v;
        const recipe = c[10]?.v;

        if(id){
            current={
                name:name,
                cost:parseFloat(cost)||0,
                recipe:recipe||"",
                tools:[],
                ings:[],
                photo:photos[name] || ""
            };
            cocktails.push(current);
        }

        if(ing){
            current?.ings.push(`${ing} ${qty} ${unit}`);
        }

        if(tool){
            current?.tools.push(tool);
        }
    });

    render();
});

function render(){
    const list=document.getElementById("list");
    list.innerHTML="";

    cocktails.forEach((c,i)=>{

        list.innerHTML+=`
        <div class="card">

            ${c.photo ? `<img src="${c.photo}">` : ""}

            <h2>${c.name}</h2>

            ${c.ings.join("<br>")}

            <div class="tools">
                ${c.tools.join(" • ")}
            </div>

            <div class="recipe">
                ${c.recipe}
            </div>

            <br>
            Сделано:
            <input type="number" value="0" min="0" onchange="calc()">
        </div>`;
    });
}

function calc(){
    total=0;
    document.querySelectorAll("input").forEach((inp,i)=>{
        total += (parseInt(inp.value)||0)*cocktails[i].cost;
    });
    document.getElementById("sum").innerText=total;
}

</script>
</body>
</html>
