<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Бармен</title>
<style>
body{
    background:#000;
    color:#fff;
    font-family:Arial;
    text-align:center;
}
.card{
    border:1px solid #333;
    border-radius:14px;
    margin:30px auto;
    padding:20px;
    width:420px;
}
img{
    width:240px;
    border-radius:12px;
}
.row{
    display:flex;
    justify-content:space-between;
    margin:4px 0;
}
.price{ color:#7CFC00; }
.total{ color:#7CFC00; font-weight:bold; margin-top:10px;}
</style>
</head>
<body>

<h1>Панель бармена</h1>
<h2 id="sum">Сумма: 0 ₽</h2>

<div id="app"></div>

<script>

const ID="1CceZ3cIic_k9Z9GnXg_wOzoUGdYonzVkfypmSzf_ln8";

const techURL=`https://opensheet.elk.sh/${ID}/БАР_КУХНЯ`;
const menuURL=`https://opensheet.elk.sh/${ID}/MENU`;

let tech=[];
let menu=[];

Promise.all([
fetch(techURL).then(r=>r.json()),
fetch(menuURL).then(r=>r.json())
]).then(([t,m])=>{
    tech=t;
    menu=m;
    render();
});

function getPrice(name){
    let row=tech.find(r=>r["Магазин"]==name);
    if(!row) return 0;

    let raw=row["undefined"];   // ← ВОТ ОНА ЦЕНА ИЗ R
    if(!raw) return 0;

    raw=raw.replace("₽","").replace(",",".");
    return parseFloat(raw)||0;
}

function render(){

    const app=document.getElementById("app");
    app.innerHTML="";

    menu.forEach(c=>{

        if(!c.Коктейль) return;

        let block=document.createElement("div");
        block.className="card";

        let html=`<h2>${c.Коктейль}</h2>`;

        if(c.Фото){
            html+=`<img src="${c.Фото}">`;
        }

        let total=0;

        tech.forEach(r=>{

            if(r["Технологические карты"]!=c["№"]) return;
            if(!r["Ингредиент"]) return;

            let name=r["Ингредиент"];
            let qty=parseFloat(r["Кол-во"])||0;

            let p=getPrice(name);
            let sum=p*qty;
            total+=sum;

            html+=`
            <div class="row">
            <div>${name} ${qty}</div>
            <div class="price">${sum.toFixed(2)} ₽</div>
            </div>`;
        });

        html+=`<div class="total">Стоимость коктейля: ${total.toFixed(2)} ₽</div>`;

        html+=`
        <div style="margin-top:10px">
        Сделано: <input type="number" value="0" style="width:60px">
        </div>`;

        block.innerHTML=html;
        app.appendChild(block);

    });
}

</script>
</body>
</html>
